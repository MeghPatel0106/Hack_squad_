{% extends "base.html" %}

{% block title %}Buyer Panel - Green Hydrogen Credits{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-8 text-white">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold mb-2">Buyer Panel</h1>
                <p class="text-indigo-100 text-lg">Browse and purchase verified green hydrogen credits</p>
            </div>
            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Purchase Stats Section -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 text-center">
            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                </svg>
            </div>
                            <div class="text-2xl font-bold text-gray-900">{{ credits_purchased }}</div>
                <div class="text-sm text-gray-600">Credits Purchased</div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 text-center">
            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                </svg>
            </div>
                            <div class="text-2xl font-bold text-gray-900">${{ "%.2f"|format(total_spent) }}</div>
                <div class="text-sm text-gray-600">Total Spent</div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 text-center">
            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
            </div>
                            <div class="text-2xl font-bold text-gray-900">{{ tokens_acquired }}</div>
                <div class="text-sm text-gray-600">Tokens Acquired</div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100 text-center">
            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m4 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
                            <div class="text-2xl font-bold text-gray-900">${{ "%.2f"|format(avg_price) }}</div>
                <div class="text-sm text-gray-600">Avg. Price/Token</div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-gray-900">Filter Credits</h2>
            <div class="text-sm text-gray-600">
                {{ available_credits|length }} credits available 
                <span class="text-xs text-gray-500">
                    ({{ available_credits|selectattr('status', 'equalto', 'approved')|list|length }} approved, 
                    {{ available_credits|selectattr('status', 'equalto', 'pending')|list|length }} pending)
                </span>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label for="source_filter" class="block text-sm font-medium text-gray-700 mb-2">Energy Source</label>
                <select id="source_filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">All Sources</option>
                    <option value="solar">Solar Power</option>
                    <option value="wind">Wind Power</option>
                    <option value="hydro">Hydroelectric</option>
                    <option value="biomass">Biomass</option>
                    <option value="geothermal">Geothermal</option>
                </select>
            </div>
            
            <div>
                <label for="price_filter" class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
                <select id="price_filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">All Prices</option>
                    <option value="0-2">$0 - $2</option>
                    <option value="2-4">$2 - $4</option>
                    <option value="4-6">$4 - $6</option>
                    <option value="6+">$6+</option>
                </select>
            </div>
            
            <div>
                <label for="location_filter" class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                <select id="location_filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">All Locations</option>
                    <option value="california">California</option>
                    <option value="texas">Texas</option>
                    <option value="oregon">Oregon</option>
                    <option value="florida">Florida</option>
                </select>
            </div>
            
            <div>
                <label for="sort_by" class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                <select id="sort_by" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="price_low">Price: Low to High</option>
                    <option value="price_high">Price: High to Low</option>
                    <option value="date_new">Date: Newest First</option>
                    <option value="date_old">Date: Oldest First</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Available Credits Section -->
    <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-gray-900">Available Credits</h2>
            <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                </svg>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for credit in available_credits %}
            {% set color_map = {'solar': 'green', 'wind': 'blue', 'hydro': 'purple', 'biomass': 'yellow', 'geothermal': 'red'} %}
            {% set color = color_map.get(credit.renewable_source, 'green') %}
            <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 bg-gradient-to-br from-{{ color }}-50 to-{{ color }}-100">
                {% if credit.certification_type == 'premium' %}
                <div class="absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">
                    Premium
                </div>
                {% endif %}
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-{{ color }}-100 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-{{ color }}-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-900">{{ credit.renewable_source.title() }} Hydrogen Credit</div>
                            <div class="text-sm text-gray-600">
                                {{ credit.tokens_generated }} Tokens - 
                                {% if credit.status == 'approved' %}
                                    <span class="text-green-600 font-medium">✓ Verified</span>
                                {% elif credit.status == 'pending' %}
                                    <span class="text-yellow-600 font-medium">⏳ Pending Approval</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-3 mb-6">
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <span>📍 {{ credit.facility_name }}, {{ credit.location }}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <span>📅 {{ credit.created_at.strftime('%b %d, %Y') }}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm text-gray-600">
                        <span>🏭 Facility: {{ credit.facility_name }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Price per Token:</span>
                        <span class="font-bold text-{{ color }}-600 text-xl">${{ "%.2f"|format(credit.price_per_token) }}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Total:</span>
                        <span class="font-bold text-{{ color }}-600 text-lg">${{ "%.2f"|format(credit.tokens_generated * credit.price_per_token) }}</span>
                    </div>
                </div>
                <form method="POST" action="{{ url_for('buy_credit') }}" class="inline">
                    <input type="hidden" name="credit_id" value="{{ credit.credit_id }}">
                    {% if credit.status == 'approved' %}
                        <button type="submit" class="w-full bg-{{ color }}-600 hover:bg-{{ color }}-700 text-white py-3 px-4 rounded-lg font-medium transition-colors transform hover:scale-105">
                            Buy Credit
                        </button>
                    {% else %}
                        <button type="button" disabled class="w-full bg-gray-400 text-gray-600 py-3 px-4 rounded-lg font-medium cursor-not-allowed">
                            ⏳ Pending Approval
                        </button>
                    {% endif %}
                </form>
            </div>
            {% else %}
            <div class="col-span-full text-center py-12 text-gray-500">
                <p class="text-lg">No credits available for purchase at the moment.</p>
                <p class="text-sm mt-2">Check back later for new hydrogen credits!</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Purchase History Section -->
    <div class="bg-white rounded-xl shadow-lg p-8 border border-gray-100">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-gray-900">Purchase History</h2>
            <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
        </div>
        
        <div class="space-y-4">
            {% for transaction in purchase_history %}
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold text-gray-900">{{ transaction.credit.renewable_source.title() }} Hydrogen Credit</div>
                        <div class="text-sm text-gray-600">{{ transaction.credit.tokens_generated }} Tokens - {{ transaction.credit.facility_name }}</div>
                        <div class="text-xs text-gray-500">{{ transaction.created_at.strftime('%b %d, %Y') }} - Transaction ID: #{{ transaction.transaction_id[:8] }}</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="font-bold text-green-600">${{ "%.2f"|format(transaction.amount) }}</div>
                    <div class="text-xs text-gray-500">{{ transaction.transaction_type.title() }}</div>
                </div>
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-500">
                <p>No purchase history yet. Start buying hydrogen credits!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
